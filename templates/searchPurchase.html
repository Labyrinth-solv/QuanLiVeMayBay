<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search & Purchase Flights</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app_base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/searchPurchase.css') }}">
    
    <link rel="icon" href="{{ url_for('static', filename='img/favicon-32x32.png') }}" type="image/png">
</head>

<body>

<div class="app-panel">

    <header class="app-header">
        <div class="header-welcome">
            <h1>Welcome {{name}}.</h1> 
            <p class="sub-heading">Find and book your next flight.</p>
        </div>
        <div class="header-links">
            <a href="/customerLogout" class="logout-link">Logout</a>
            <a href="/customerHome" class="home-link">Return to Home</a>
        </div>
    </header>

    <main class="app-content">

        <form action="/searchPurchaseFlight" method="POST">
            <h2>Search For Flights</h2>

            <label>Source City or Airport:</label>
            <input type="text" name="source" required>
            
            <label>Destination City or Airport:</label>
            <input type="text" name="destination" required>
            
            <label>Departure Date:</label>
            <input type="date" name="depart_date">
            
            <label>Return Date:</label>
            <input type="date" name="return_date">
            
            <input type="submit" value="Search">
            
            {% if error %}
                <p class="error"><strong>Error:</strong> {{error}}</p>
            {% endif %} 
        </form>

        {% if departing_flights or returning_flights %}
        <h2 class="table-heading">Searched Flights</h2>
        <table>
            <thead>
                <tr>
                    <th>Airline Name</th>
                    <th>Flight Number</th>
                    <th>Source Airport</th>
                    <th>Destination Airport</th>
                    <th>Departure Date and Time</th>
                    <th>Landing Date and Time</th>
                    <th>Base Price</th>
                    <th>Airplane ID</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for line in departing_flights %}
                <tr>
                    <td>{{line['name']}}</td>
                    <td>{{line['flight_number']}}</td>
                    <td>{{line['dep_airport']}}</td>
                    <td>{{line['arr_airport']}}</td>
                    <td>{{line['dep_date_time']}}</td>
                    <td>{{line['arr_date_time']}}</td>
                    <td>{{line['base_price']}}</td>
                    <td>{{line['ID']}}</td>
                    <td>{{line['status']}}</td>
                </tr>
                {% endfor %}
                {% for line in returning_flights %}
                <tr>
                    <td>{{line['name']}}</td>
                    <td>{{line['flight_number']}}</td>
                    <td>{{line['dep_airport']}}</td>
                    <td>{{line['arr_airport']}}</td>
                    <td>{{line['dep_date_time']}}</td>
                    <td>{{line['arr_date_time']}}</td>
                    <td>{{line['base_price']}}</td>
                    <td>{{line['ID']}}</td>
                    <td>{{line['status']}}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        <form action="/purchase" method="POST">
            <h2>Purchase Flight</h2>

            <label>Airline Name:</label>
            <input type="text" name="airline_name" required>
            
            <label>Flight Number:</label>
            <input type="number" name="flight_number" required>
            
            <input type="submit" value = "Purchase Flight" />

            {% if error2 %}
               <p class="error"><strong>Error:</strong> {{error2}}</p>
            {% endif %}    
        </form>

        {% if flight_info %}
        <h2 class="table-heading">Selected Flight</h2>
        <table>
            <thead>
                <tr>
                    <th>Sale Price</th>
                    <th>Airline Name</th>
                    <th>Flight Number</th>
                    <th>Source Airport</th>
                    <th>Destination Airport</th>
                    <th>Departure Date and Time</th>
                    <th>Landing Date and Time</th>
                    <th>Airplane ID</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{flight_info['sale_price']}}</td>
                    <td>{{flight_info['name']}}</td>
                    <td>{{flight_info['flight_number']}}</td>
                    <td>{{flight_info['dep_airport']}}</td>
                    <td>{{flight_info['arr_airport']}}</td>
                    <td>{{flight_info['dep_date_time']}}</td>
                    <td>{{flight_info['arr_date_time']}}</td>
                    <td>{{flight_info['ID']}}</td>
                    <td>{{flight_info['status']}}</td>
                </tr>
            </tbody>
        </table>
        {% endif %}

        {% if processing %}
        <form action="/purchaseInfo" method="POST">
            <input type="hidden" name="flight_info"/>
            <h2>Purchasing Details</h2>

            <label>Confirm Airline Name:</label>
            <input type="text" name="airline_name" required>
            
            <label>Confirm Flight Number:</label>
            <input type="number" name="flight_number" required>
            
            <label>Card Type:</label>
            <input type="text" name="card_type" required>
            
            <label>Card Number:</label>
            <input type="text" name="card_number" required> 
            
            <label>Name on Card:</label>
            <input type="text" name="name_on_card" required>
            
            <label>Expiration Date:</label>
            <input type="date" name="expiration_date" required>
            
            <label>Security Code (CVV):</label>
            <input type="password" name="security_code">
            
            <input type="submit" value="Complete Purchase" />
        </form>
        {% endif %}

    </main> </div> </body>
</html>