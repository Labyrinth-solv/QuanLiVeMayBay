<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Flights</title>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        th, td {
            padding: 5px;
        }
    </style>
</head>

<body>

    <h1>View Flights</h1>

    <!-- Flights in next 30 days -->
    <h2>Flights in Next 30 Days</h2>
    <table>
        <thead>
            <tr>
                <th>Airline Name</th>
                <th>Flight Number</th>
                <th>Source Airport</th>
                <th>Destination Airport</th>
                <th>Departure Date and Time</th>
                <th>Landing Date and Time</th>
                <th>Base Price</th>
                <th>Airplane ID</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for line in next30 %}
            <tr>
                <td>{{ line.name }}</td>
                <td>{{ line.flight_number }}</td>
                <td>{{ line.dep_airport }}</td>
                <td>{{ line.arr_airport }}</td>
                <td>{{ line.dep_date_time }}</td>
                <td>{{ line.arr_date_time }}</td>
                <td>{{ line.base_price }}</td>
                <td>{{ line.ID }}</td>
                <td>{{ line.status }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <br>

    <!-- Search flights -->
    <h2>Search Flights</h2>
    <form action="{{ url_for('staffHome.searchStaffFlights') }}" method="POST">
        <label>Source Airport:</label>
        <select name="source">
            <option value="">-- Select Source --</option>
            {% for ap in airports %}
            <option value="{{ ap.name }}">{{ ap.city }} ({{ ap.name }})</option>
            {% endfor %}
        </select>
        <br><br>

        <label>Destination Airport:</label>
        <select name="destination">
            <option value="">-- Select Destination --</option>
            {% for ap in airports %}
            <option value="{{ ap.name }}">{{ ap.city }} ({{ ap.name }})</option>
            {% endfor %}
        </select>
        <br><br>

        <label>Start Date:</label>
        <input type="date" name="start_date">

        <label>End Date:</label>
        <input type="date" name="end_date">

        <input type="submit" value="Search">
    </form>
    <a href="/staffHome">Return to Home</a>

    {% if search_flights %}
    <h3>Search Results</h3>
    <table>
        <thead>
            <tr>
                <th>Flight Number</th>
                <th>Source</th>
                <th>Destination</th>
                <th>Departure</th>
            </tr>
        </thead>
        <tbody>
            {% for f in search_flights %}
            <tr>
                <td>{{ f.flight_number }}</td>
                <td>{{ f.dep_airport }}</td>
                <td>{{ f.arr_airport }}</td>
                <td>{{ f.dep_date_time }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <br>

    <!-- Search customers -->
    <h2>Search Customers by Flight</h2>
    <form method="POST" action="{{ url_for('staffHome.searchFlightCustomers') }}">
        <label for="flight_number">Select Flight:</label>
        <select name="flight_number" id="flight_number" required>
            <option value="">-- Choose Flight --</option>
            {% for f in flights %}
            <option value="{{ f.flight_number }}">
                {{ f.flight_number }} | {{ f.dep_airport }} â†’ {{ f.arr_airport }} ({{ f.dep_date_time }})
            </option>
            {% endfor %}
        </select>
        <button type="submit">Search</button>
    </form>
    <a href="/staffHome">Return to Home</a>

    {% if search_flight_customers %}
    <h3>Customers on Flight</h3>
    <table>
        <thead>
            <tr>
                <th>Email</th>
                <th>Name</th>
                <th>Seat</th>
            </tr>
        </thead>
        <tbody>
            {% for c in search_flight_customers %}
            <tr>
                <td>{{ c.email }}</td>
                <td>{{ c.customer_name }}</td>
                <td>{{ c.seat_number }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% elif error2 %}
    <p style="color:red">{{ error2 }}</p>
    {% endif %}

</body>
</html>
